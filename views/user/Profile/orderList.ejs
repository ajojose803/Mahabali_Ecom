<%- include('../../partials/userHeader')-%>
    <!-- Breadcrumb Begin -->
    <style>
        .shop__sidebar {
            padding: 20px;
        }

        .contact__content ul {
            list-style-type: none;
            padding: 0;
        }

        .contact__content ul a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: black;
            border-bottom: 1px solid #ddd;
        }

        .contact__content ul a.active {
            background-color: #c91414;
            color: white;
        }

        .contact__content ul a:hover {
            background-color: #f0f0f0;
        }

        .order-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .order-card h4 {
            margin-bottom: 15px;
        }

        .order-card .order-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .order-card .order-info div {
            flex: 1;
        }

        .order-card .order-info div:not(:last-child) {
            margin-right: 20px;
        }

        .order-card .order-actions {
            text-align: right;
        }

        .order-card .order-actions button {
            padding: 10px 20px;
            background-color: #c91414;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .order-card .order-actions button:hover {
            background-color: #811111;
        }

        .order-products {
            margin-top: 20px;
        }

        .product-item {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .cancel-product-button {
            margin-top: 1%;
            padding: 5px 10px;
            background-color: #c91414;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .cancel-product-button:hover {
            background-color: #811111;
        }
    </style>
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="/"><i class="fa fa-home"></i> Home</a>
                        <a href="/profile">My Account</a>
                        <span>Order Information</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

<!-- Order History Section Begin -->
<section class="spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-3">
                <div class="shop__sidebar">
                    <!-- Filter Sidebar -->
                    <div class="contact__content">
                        <h5 class=>My Account</h5>
                        <br>
                        <ul>
                            <a href="/profile/">
                                <span class="fa fa-info-circle" style="margin-right: 10px;"></span> Personal Information
                            </a>
                            <a href="/profile/address">
                                <span class="fa fa-address-card" style="margin-right: 10px;"></span> Address
                            </a>
                            <a href="/profile/orders" class="active">
                                <span class="fa fa-shopping-bag" style="margin-right: 10px;"></span> Orders
                            </a>
                            <a href="/profile/wallet">
                                <span class="fa fa-credit-card" style="margin-right: 10px;"></span> Wallet
                            </a>
                            <a href="/profile/change-password">
                                <span class="fa fa-key" style="margin-right: 10px;"></span> Change Password
                            </a>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-9 col-md-9">
                <div class="order-history">
                    <% if(order && order.length> 0) { %>
                    <% order.forEach(function(data) { %>
                    <div class="order-card">
                        <h4>Order ID: <%= data.orderId %>
                        </h4>
                        <div class="order-info">
                            <div>
                                <strong>Order Date:</strong>
                                <%= new Date(data.createdAt).toLocaleString('en-US', { year: 'numeric' ,
                                month: 'short' , day: 'numeric' , hour: 'numeric' , minute: 'numeric' ,
                                second: 'numeric' , hour12: false }) %>
                            </div>
                            <div>
                                <strong>Amount:</strong> ₹ <%= data.amount %>
                            </div>
                            <div>
                                <strong>Status:</strong>
                                <%= data.status.charAt(0).toUpperCase() + data.status.slice(1) %>
                            </div>
                        </div>
                        <div class="order-info">
                            <div>
                                <strong>Delivery Address:</strong>
                                <%= data.address.firstName %>
                                <%= data.address.lastName %>, <%= data.address.addressline1 %>, <%= data.address.city %>, <%= data.address.state %>, <%= data.address.pincode %>
                            </div>
                            <div>
                                <strong>Payment Method:</strong>
                                <%= data.payment %>
                            </div>
                        </div>
                        <div class="order-products">
                            <h5>Products:</h5>
                            </br>
                            <% data.items.forEach(function(item) { %>
                            <div class="product-item">
                                <strong>Name:</strong>
                                <%= item.productId.name %><br>
                                <strong>Price:</strong> ₹ <%= item.price %><br>
                                <strong>Quantity:</strong> <%= item.quantity %><br>
                                <button a href="/order/:orderId/cancel-product/:productId" class="cancel-product-button" data-order-id="<%= data.orderId %>" data-product-id="<%= item.productId._id %>">Cancel Product</button>
                            </div>
                            <br>
                            <% }); %>
                        </div>
                        <div class="order-actions">
                            <button onclick="viewOrderDetails('<%= data.orderId %>')">View Order Details</button>
                            <button onclick="generateInvoice('<%= data.orderId %>')">Invoice</button>
                            <button onclick="cancelOrder('<%= data.orderId %>')">Cancel Order</button>
                        </div>
                    </div>
                    <% }); %>
                    <% } else { %>
                    <p>No orders found.</p>
                    <% } %>
                </div>

            </div>
        </div>
    </div>
</section>
<!-- Order History Section End -->

<%- include('../../partials/userFooter')-%>

<!-- JavaScript to handle actions -->
<script>
    // Function to view order details
    function viewOrderDetails(orderId) {
        window.location.href = '/checkout/order-status/' + orderId;
    }

    // Function to generate invoice
    function generateInvoice(orderId) {
        window.location.href = '/order/invoice/' + orderId;
    }

    // Function to cancel order with SweetAlert confirmation
    function cancelOrder(orderId) {
        Swal.fire({
            title: 'Are you sure?',
            text: 'You will not be able to recover this order!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, cancel it!'
        }).then((result) => {
            if (result.isConfirmed) {
                // Perform the cancellation action, e.g., redirect to cancel endpoint
                window.location.href = '/order/' + orderId + '/cancel';
            }
        });
    }

    // Function to cancel product with SweetAlert confirmation
    document.querySelectorAll('.cancel-product-button').forEach(item => {
        item.addEventListener('click', function() {
            let orderId = this.getAttribute('data-order-id');
            let productId = this.getAttribute('data-product-id');
            Swal.fire({
                title: 'Are you sure?',
                text: 'You will not be able to recover this product!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, cancel it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Perform the cancellation action, e.g., redirect to cancel product endpoint
                    window.location.href = '/order/' + orderId + '/cancel-product/' + productId;
                }
            });
        });
    });
</script>